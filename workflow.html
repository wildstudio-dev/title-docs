<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.0 Workflow Layers | Title Analysis System Documentation</title>
    <meta name="description" content="2.0 Workflow Layers - Title Analysis System Documentation">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="sidebar">
        <div class="nav-section">
            <h3>Overview</h3>
            <a href="architecture.html" class="nav-item">1.0 Architecture</a>
            <a href="workflow.html" class="nav-item">2.0 Workflow Layers</a>
            <a href="passes.html" class="nav-item">3.0 Three-Pass Strategy</a>
        </div>
        <div class="nav-section">
            <h3>Implementation</h3>
            <a href="dataflow.html" class="nav-item">4.0 Data Flow</a>
            <a href="steps.html" class="nav-item">5.0 Step Reference</a>
            <a href="satisfaction.html" class="nav-item">6.0 Satisfaction Algorithm</a>
        </div>
        <div class="nav-section">
            <h3>Optimization</h3>
            <a href="decisions.html" class="nav-item">7.0 Decision Points</a>
            <a href="bottlenecks.html" class="nav-item">8.0 Bottlenecks</a>
            <a href="improvements.html" class="nav-item">9.0 Improvements</a>
        </div>
        <div class="nav-section">
            <h3>Reference</h3>
            <a href="prompts.html" class="nav-item">10.0 Prompt Strategy</a>
            <a href="schemas.html" class="nav-item">11.0 Data Schemas</a>
            <a href="metrics.html" class="nav-item">12.0 Metrics</a>
        </div>
    </div>

    <div class="main-content">
        <div class="doc-header">
            <h1>Title Analysis System Documentation</h1>
            <p class="subtitle">LangGraph-based AI Pipeline for ALTA Title Commitments</p>
            <div>
                <span class="version-badge">v2.0.0</span>
                <span class="version-badge">Last Updated: October 2024</span>
                <span class="version-badge">Status: Production</span>
            </div>
        </div>

        <div class="section active">

            <h2>2.0 Workflow Layers</h2>
            
            <p>The system processes documents through 6 distinct layers, with Layer 4 reserved for future enhancements. Each layer contains specific processing steps that may execute in parallel where dependencies allow.</p>

            <div class="layer-section">
                <h3>Layer 1: Raw Extraction (Parallel)</h3>
                <p>Initial document analysis with maximally inclusive extraction strategy.</p>
                
                <div class="step-grid">
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>extract_analyze_docs</h4>
                        <p>Analyze each document individually with Gemini 2.5 Pro</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">DocumentAnalyzer</span><br>
                            <strong>Batch Size:</strong> 200 documents<br>
                            <strong>Processing:</strong> Concurrent via asyncio<br>
                            <strong>Output Schema:</strong> <span class="inline-code">OneDocSchema</span><br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_report:doc:{doc_id}:analysis</span><br>
                            <strong>Strategy:</strong> "When in doubt, include it"
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>analyze_tax_history</h4>
                        <p>Extract tax encumbrances from database</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">TaxEncumbranceAnalyzer</span><br>
                            <strong>Data Source:</strong> Direct database query<br>
                            <strong>Processing:</strong> Rule-based (no LLM)<br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_tax_encumbrances</span><br>
                            <strong>Output:</strong> Tax liens and assessments
                        </div>
                    </div>
                </div>
            </div>

            <div class="layer-section">
                <h3>Layer 2: Enrichment & Analysis (8 Parallel Operations)</h3>
                <p>Semantic understanding, classification, and deterministic satisfaction matching.</p>
                
                <div class="step-grid">
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>summarize_docs</h4>
                        <p>Create human-readable summaries</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">DocSummarizer</span><br>
                            <strong>Input:</strong> Document analyses from Layer 1<br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_docs_summaries</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>summarize_encumbrances</h4>
                        <p>Summarize all encumbrances</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">EncumbranceSummarizer</span><br>
                            <strong>AIData Key:</strong> <span class="inline-code">encumbrance_summaries</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>classify_encumbrances</h4>
                        <p>Assign types and severity scores</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">EncumbranceClassifier</span><br>
                            <strong>Batch Size:</strong> 50 encumbrances<br>
                            <strong>Output:</strong> Type, subtype, severity (0-10)<br>
                            <strong>AIData Key:</strong> <span class="inline-code">encumbrance_classifications</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>resolve_satisfactions</h4>
                        <p>Deterministic satisfaction matching</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">SatisfactionResolver</span><br>
                            <strong>Algorithm:</strong> String matching + temporal validation<br>
                            <strong>Processing:</strong> Pure deterministic (no LLM)<br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_encumbrance_releases</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>chain_of_title</h4>
                        <p>Trace ownership transfers</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">ChainOfTitleAnalyzer</span><br>
                            <strong>Analysis:</strong> Ownership timeline and gaps<br>
                            <strong>AIData Key:</strong> <span class="inline-code">chain_of_title</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>encumbrance_status</h4>
                        <p>Filter for relevance (Pass 3)</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">EncumbranceStatusAnalyzer</span><br>
                            <strong>Uses:</strong> Satisfaction resolution map<br>
                            <strong>Constraints:</strong> Must respect deterministic matches<br>
                            <strong>AIData Key:</strong> <span class="inline-code">encumbrance_status_analysis</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>assess_confidence</h4>
                        <p>Overall confidence scoring</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">AssessTitleDocsConfidence</span><br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_docs_confidence_assessment</span>
                        </div>
                    </div>
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>generate_overall_summary</h4>
                        <p>Executive summary generation</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">GenerateOverallSummary</span><br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_report_confidence_summary</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layer-section">
                <h3>Layer 3: Aggregation</h3>
                <p>Combine tax and document encumbrances with deduplication.</p>
                
                <div class="step-grid">
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>aggregate_tax_title</h4>
                        <p>Merge and deduplicate all encumbrances</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">AggregateTitleEncumbrances</span><br>
                            <strong>Sources:</strong> Tax + document encumbrances<br>
                            <strong>AIData Key:</strong> <span class="inline-code">aggregated_title_encumbrances</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layer-section">
                <h3>Layer 5: Report Data Collection</h3>
                <p>Aggregate all AIData instances and upload master JSON.</p>
                
                <div class="step-grid">
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>aggregate_report_data</h4>
                        <p>Collect all analysis data and upload to GCS</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">AggregateReportData</span><br>
                            <strong>Collection:</strong> All AIData instances for order<br>
                            <strong>Upload:</strong> Google Cloud Storage<br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_report:master:json</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layer-section">
                <h3>Layer 6: Final Report Generation</h3>
                <p>Generate PDF reports from master JSON.</p>
                
                <div class="step-grid">
                    <div class="step-card" onclick="toggleCard(this)">
                        <h4>generate_report</h4>
                        <p>Create ALTA PDF commitment</p>
                        <div class="step-details">
                            <strong>Implementation:</strong> <span class="inline-code">GenerateReport</span><br>
                            <strong>Template Engine:</strong> Jinja2<br>
                            <strong>PDF Generator:</strong> WeasyPrint<br>
                            <strong>AIData Key:</strong> <span class="inline-code">title_report:master:pdf</span>
                        </div>
                    </div>
                </div>
            </div>
        
        </div>
    </div>
    <script src="assets/js/main.js"></script>
</body>
</html>